# –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò –ò –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

–ü—Ä–æ–≤–µ–¥—ë–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –≤ `/home/user/Opis/js/`

---

## –ü–†–û–ë–õ–ï–ú–´ –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò

### 1. –ù–ï–û–ü–¢–ò–ú–ê–õ–¨–ù–´–ï –¶–ò–ö–õ–´ –ò –û–ü–ï–†–ê–¶–ò–ò DOM

#### –ü—Ä–æ–±–ª–µ–º–∞: –ü–µ—Ä–µ–±–æ—Ä –≤—Å–µ—Ö —Å–≤–æ–π—Å—Ç–≤ window
**–§–∞–π–ª:** `/home/user/Opis/js/uso.export.js`
**–°—Ç—Ä–æ–∫–∏:** 66-72
```javascript
for (let key in w) {
  if (w[key] && w[key].PDFDocument) {
    DEBUG.log('[USO_EXPORT] PDFDocument found in window.' + key);
    w.PDFDocument = w[key].PDFDocument;
    return w.PDFDocument;
  }
}
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –¶–∏–∫–ª –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –í–°–ï —Å–≤–æ–π—Å—Ç–≤–∞ window, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω—ã–º. –í –±–æ–ª—å—à–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–º –∑–∞–¥–µ—Ä–∂–∫–∞–º.
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ namespace –∏–ª–∏ –±–æ–ª–µ–µ —É–∑–∫–∏–π –ø–æ–∏—Å–∫.

---

#### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–±–æ—Ä –ø–∏–∫—Å–µ–ª–µ–π canvas
**–§–∞–π–ª:** `/home/user/Opis/js/uso.export.js`
**–°—Ç—Ä–æ–∫–∏:** 125-134
```javascript
for (let i = 0; i < data.length; i += 4) {
  const r = data[i];
  const g = data[i + 1];
  const b = data[i + 2];
  if (r > 250 && g > 250 && b > 250) {
    whitePixels++;
  }
}
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –î–ª—è –±–æ–ª—å—à–æ–≥–æ canvas (–Ω–∞–ø—Ä–∏–º–µ—Ä, 4000x3000) —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç ~12 –º–ª–Ω –∏—Ç–µ—Ä–∞—Ü–∏–π. –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–º–æ—Ä–æ–∑–∏—Ç—å UI.
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—ã–±–æ—Ä–∫—É –ø–∏–∫—Å–µ–ª–µ–π (sampling) –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ–±–æ—Ä–∞.

---

#### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Å—Ç–æ—Ç—ã canvas
**–§–∞–π–ª:** `/home/user/Opis/js/uso.export.js`
**–°—Ç—Ä–æ–∫–∏:** 408-430
```javascript
for (let y = h - 1; y >= 0; y--) {
  let hasContent = false;
  for (let x = 0; x < w; x += 5) {  // –¥–∞–∂–µ —Å —à–∞–≥–æ–º 5
    const idx = (y * w + x) * 4;
    // ... –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∏–∫—Å–µ–ª—å
  }
  if (hasContent) {
    lastContentY = y;
    break;
  }
}
```
**–ü—Ä–æ–±–ª–µ–º–∞:** –î–ª—è canvas –≤—ã—Å–æ—Ç–æ–π 3000px —ç—Ç–æ ~3000 –∏—Ç–µ—Ä–∞—Ü–∏–π —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º. –û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ.
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–µ –∫–∞–∂–¥—ã–π –ø–∏–∫—Å–µ–ª—å, –∞ –±–ª–æ–∫–∞–º–∏ –ø–æ 50-100px.

---

### 2. –°–ò–ù–•–†–û–ù–ù–´–ï –û–ü–ï–†–ê–¶–ò–ò, –ë–õ–û–ö–ò–†–£–Æ–©–ò–ï UI

#### –ü—Ä–æ–±–ª–µ–º–∞: html2canvas —Å scale: 2
**–§–∞–π–ª:** `/home/user/Opis/js/uso.export.js`
**–°—Ç—Ä–æ–∫–∏:** 557-564
```javascript
const canvasC = await h2c(node, { 
  scale: 2,           // –í–´–°–û–ö–û–ï –ö–ê–ß–ï–°–¢–í–û = –ú–ï–î–õ–ï–ù–ù–û
  useCORS: true, 
  allowTaint: true, 
  backgroundColor: '#fff',
  logging: false,
  imageTimeout: 0
});
```
**–ü—Ä–æ–±–ª–µ–º–∞:** 
- scale: 2 –æ–∑–Ω–∞—á–∞–µ—Ç –≤ 4 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ –ø–∏–∫—Å–µ–ª–µ–π –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –î–ª—è A4 —Å—Ç—Ä–∞–Ω–∏—Ü—ã (794x1122) —ç—Ç–æ —Å–æ–∑–¥–∞—ë—Ç canvas 1588x2244 = 3.5–º–ª–Ω –ø–∏–∫—Å–µ–ª–µ–π
- –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–æ–∂–µ—Ç –∑–∞–º–æ—Ä–æ–∑–∏—Ç—å –±—Ä–∞—É–∑–µ—Ä –Ω–∞ 5-10 —Å–µ–∫—É–Ω–¥
- imageTimeout: 0 –æ–∑–Ω–∞—á–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–†–µ—à–µ–Ω–∏–µ:** 
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å scale: 1.5 –≤–º–µ—Å—Ç–æ 2
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å imageTimeout: 5000
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å progress bar

---

#### –ü—Ä–æ–±–ª–µ–º–∞: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞ –±–µ–∑ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
**–§–∞–π–ª:** `/home/user/Opis/js/uso.app.js`
**–°—Ç—Ä–æ–∫–∏:** 109-225
```javascript
fileInput.addEventListener('change', async function(e) {
  const file = e.target.files?.[0];
  // ... —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
  const imgEl = await loadImageElement(blobUrl);
  const dataUrl = drawWithOrientationExact(imgEl, orientation);
  // ... –µ—â—ë –æ–ø–µ—Ä–∞—Ü–∏–∏
```
**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –î–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (40–ú–ë) –Ω–µ—Ç feedback –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ú–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –∫–∞–∫ –∑–∞–≤–∏—Å–∞–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞
- –û—Å–æ–±–µ–Ω–Ω–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è HEIC —Ñ–∞–π–ª–æ–≤ (—Ç—Ä–µ–±—É—é—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é)

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å progress indicator —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —ç—Ç–∞–ø–µ –∑–∞–≥—Ä—É–∑–∫–∏.

---

### 3. –£–¢–ï–ß–ö–ò –ü–ê–ú–Ø–¢–ò (Event Listeners –±–µ–∑ –æ—á–∏—Å—Ç–∫–∏)

#### –ü—Ä–æ–±–ª–µ–º–∞: ResizeObserver –±–µ–∑ –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏
**–§–∞–π–ª:** `/home/user/Opis/js/uso.canvas.js`
**–°—Ç—Ä–æ–∫–∏:** 694-719
```javascript
_wrapRO = new ResizeObserver(() => {
  // ... –∫–æ–¥
  _resizeTimeout = setTimeout(() => { ... }, 500);
});
_wrapRO.observe(wrap);
```
**–ü—Ä–æ–±–ª–µ–º–∞:** 
- `_resizeTimeout` –º–æ–∂–µ—Ç –æ—Å—Ç–∞—Ç—å—Å—è –Ω–µ–æ—á–∏—â–µ–Ω–Ω—ã–º –ø—Ä–∏ –≤—ã–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ResizeObserver –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
- Visual Viewport listeners –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞—é—Ç—Å—è

**–ö—Ä–∏—Ç–∏—á–Ω–æ:** –°—Ç—Ä–æ–∫–∏ 152-160 (visualViewport listeners)
```javascript
if (window.visualViewport) {
  vvHandler = U.util.throttle(...);
  window.visualViewport.addEventListener('resize', vvHandler);
  window.visualViewport.addEventListener('scroll', vvHandler);
}
// –ú–æ–∂–µ—Ç –Ω–µ —É–¥–∞–ª–∏—Ç—å—Å—è, –µ—Å–ª–∏ fakeFs –æ—Ç–∫–ª—é—á–∏—Ç—Å—è –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ
```

---

#### –ü—Ä–æ–±–ª–µ–º–∞: Event listeners –Ω–∞ document
**–§–∞–π–ª:** `/home/user/Opis/js/uso.canvas.js`
**–°—Ç—Ä–æ–∫–∏:** 851-858
```javascript
$(document).on('keydown.uso', function(e){
  // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞
});
```
**–ü—Ä–æ–±–ª–µ–º–∞:** Namespace 'uso' –µ—Å—Ç—å, –Ω–æ –Ω–µ—Ç —è–≤–Ω–æ–≥–æ off() –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ canvas.

---

#### –ü—Ä–æ–±–ª–µ–º–∞: setTimeout/setInterval –±–µ–∑ –æ—á–∏—Å—Ç–∫–∏
**–§–∞–π–ª:** `/home/user/Opis/js/uso.app.js`
**–°—Ç—Ä–æ–∫–∏:** 643-681
```javascript
autosaveTimer = setInterval(function(){
  // ... autosave
  localStorage.setItem(AUTOSAVE_KEY, json);
}, AUTOSAVE_INTERVAL);
```
**–ü—Ä–æ–±–ª–µ–º–∞:** 
- Interval –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ, –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Ö–æ–¥–∏—Ç —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ù–µ—Ç –æ—á–∏—Å—Ç–∫–∏ –ø—Ä–∏ –≤—ã–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–Ω–µ—Ç window.addEventListener('beforeunload', ...))

---

### 4. –ò–ó–ë–´–¢–û–ß–ù–´–ï –ü–ï–†–ï–†–ò–°–û–í–ö–ò CANVAS

#### –ü—Ä–æ–±–ª–µ–º–∞: requestRenderAll –≤ —Ü–∏–∫–ª–µ
**–§–∞–π–ª:** `/home/user/Opis/js/uso.canvas.js`
**–°—Ç—Ä–æ–∫–∏:** 494-505
```javascript
function rescaleAllMarkers(){
  const markers = getMarkersForCurrentImage();
  markers.forEach(rescaleMarker);  // –∫–∞–∂–¥—ã–π rescaleMarker –≤—ã–∑—ã–≤–∞–µ—Ç setCoords()
  if (midline) { ... }
  mainCanvas.requestRenderAll();  // —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –≤ –∫–æ–Ω—Ü–µ - –•–û–†–û–®–û
}
```
**–•–æ—Ä–æ—à–æ –∑–¥–µ—Å—å**, –Ω–æ –ø—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö.

#### –ü—Ä–æ–±–ª–µ–º–∞: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ mouse:move
**–§–∞–π–ª:** `/home/user/Opis/js/uso.canvas.js`
**–°—Ç—Ä–æ–∫–∏:** 902-908
```javascript
mainCanvas.on('mouse:move', function(opt){
  if (drawState && drawState.mode==='line'){
    const p = mainCanvas.getPointer(opt.e);
    drawState.lineObj.set({ x2:p.x, y2:p.y });
    drawState.lineObj.setCoords();
    mainCanvas.requestRenderAll();  // –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –ö–ê–ñ–î–û–ï –¥–≤–∏–∂–µ–Ω–∏–µ –º—ã—à–∏!
  }
});
```
**–ü—Ä–æ–±–ª–µ–º–∞:** requestRenderAll –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –º—ã—à–∏, –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ 60+ –≤—ã–∑–æ–≤–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É.
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å requestAnimationFrame –¥–ª—è debounce.

---

### 5. –ë–û–õ–¨–®–ò–ï –§–£–ù–ö–¶–ò–ò –ë–ï–ó –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò

#### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ—Ç–æ–¥ exportPDF
**–§–∞–π–ª:** `/home/user/Opis/js/uso.export.js`
**–°—Ç—Ä–æ–∫–∏:** 798-904
–§—É–Ω–∫—Ü–∏—è ~100 —Å—Ç—Ä–æ–∫ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π, –≤–∫–ª—é—á–∞—è:
- –ó–∞–≥—Ä—É–∑–∫—É –±–∏–±–ª–∏–æ—Ç–µ–∫
- –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ HTML –≤ canvas
- –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ PDF
- UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–±–∏—Ç—å –Ω–∞ –º–µ–Ω—å—à–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ª—É—á—à–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è.

---

### 6. –û–¢–°–£–¢–°–¢–í–ò–ï DEBOUNCE/THROTTLE

#### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Ç throttle –Ω–∞ —Ä–µ–∂–∏–º–∞—Ö —Ä–∞–±–æ—Ç—ã
**–§–∞–π–ª:** `/home/user/Opis/js/uso.app.js`
**–°—Ç—Ä–æ–∫–∏:** 44-60
```javascript
modeSelect.addEventListener('change', function() {
  // ... –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞
  recompute();  // –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω–æ –º–Ω–æ–≥–æ —Ä–∞–∑ –±—ã—Å—Ç—Ä–æ
});
```

#### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Ç debounce –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
**–§–∞–π–ª:** `/home/user/Opis/js/uso.app.js`
**–°—Ç—Ä–æ–∫–∏:** 384-395
```javascript
$(document).on('change', 'input.uso-mat', function(){
  // ...
  recomputeDebounced();  // –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –•–û–†–û–®–û
});
```
**–•–æ—Ä–æ—à–æ –∑–¥–µ—Å—å**, –Ω–æ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö.

#### –ü—Ä–æ–±–ª–µ–º–∞: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ input event
**–§–∞–π–ª:** `/home/user/Opis/js/uso.app.js`
**–°—Ç—Ä–æ–∫–∏:** 556-593
```javascript
$('#uso-patient-phone').on('input paste', function(e){
  const self = this;
  setTimeout(() => {  // 10–º—Å –∑–∞–¥–µ—Ä–∂–∫–∞
    let val = self.value;
    val = val.replace(/[^\d+]/g, '');
    // ... –º–Ω–æ–≥–æ –æ–ø–µ—Ä–∞—Ü–∏–π
  }, 10);
});
```
**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥—ã–π –≤–≤–æ–¥–∏–º—ã–π —Å–∏–º–≤–æ–ª
- –ú–Ω–æ–≥–æ regex –æ–ø–µ—Ä–∞—Ü–∏–π
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –≤–≤–æ–¥–µ

---

### 7. –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò

#### –ü—Ä–æ–±–ª–µ–º–∞: Autosave –ø–∏—à–µ—Ç –≤ localStorage –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
**–§–∞–π–ª:** `/home/user/Opis/js/uso.app.js`
**–°—Ç—Ä–æ–∫–∏:** 665-670
```javascript
if (json.length > 1024 * 1024) {
  console.warn('[USO] Autosave data too large...');
  return;
}
localStorage.setItem(AUTOSAVE_KEY, json);
```
**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –ü–∏—à–µ—Ç –≤ localStorage –¥–∞–∂–µ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
- –î–ª—è –±–æ–ª—å—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ —ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å –±—Ä–∞—É–∑–µ—Ä
- localStorage –±–ª–æ–∫–∏—Ä—É–µ—Ç –≥–ª–∞–≤–Ω—ã–π –ø–æ—Ç–æ–∫

**–†–µ—à–µ–Ω–∏–µ:** –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–µ–π –∏ –ø–∏—Å–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö.

---

## –ü–†–û–ë–õ–ï–ú–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### 1. –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï innerHTML –ë–ï–ó –ó–ê–©–ò–¢–´

#### –ü—Ä–æ–±–ª–µ–º–∞: innerHTML –≤ buildPDFBlob
**–§–∞–π–ª:** `/home/user/Opis/js/uso.export.js`
**–°—Ç—Ä–æ–∫–∏:** 543-545
```javascript
const node = document.createElement('div');
node.style.width='794px';
node.innerHTML = html;  // ‚ö†Ô∏è –û–ü–ê–°–ù–û –µ—Å–ª–∏ html –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è
```
**–£—è–∑–≤–∏–º–æ—Å—Ç—å:** XSS - –µ—Å–ª–∏ `html` —Å–æ–¥–µ—Ä–∂–∏—Ç user-controlled content, –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω JavaScript.
**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** `html` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∏–∑ `buildPDFHtml()` –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `split().join()` –¥–ª—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏, —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —É—è–∑–≤–∏–º–æ.

**–ü—Ä–∏–º–µ—Ä —É—è–∑–≤–∏–º–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è:**
```javascript
// –ï—Å–ª–∏ patient_name —Å–æ–¥–µ—Ä–∂–∏—Ç: <img src=x onerror="alert('XSS')">
const html = tpl.split('{{patient_name}}').join(name);
node.innerHTML = html;  // XSS –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è!
```

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `textContent` –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–ª–∏ `appendChild` —Å –∑–∞—â–∏—Ç–æ–π:
```javascript
// –í–º–µ—Å—Ç–æ split/join –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å innerHTML –¥–ª—è template + textContent –¥–ª—è values
const safeInnerHTML = buildSafeHTML(tpl, {patient_name: name, ...});
node.innerHTML = safeInnerHTML;
```

---

#### –ü—Ä–æ–±–ª–µ–º–∞: innerHTML –≤ htmlToText
**–§–∞–π–ª:** `/home/user/Opis/js/uso.export.js`
**–°—Ç—Ä–æ–∫–∏:** 906-909
```javascript
function htmlToText(html) {
  const div = document.createElement('div');
  div.innerHTML = html;  // ‚ö†Ô∏è –ú–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π –∫–æ–¥
```
**–£—è–∑–≤–∏–º–æ—Å—Ç—å:** –ï—Å–ª–∏ `html` —Å–æ–¥–µ—Ä–∂–∏—Ç onload, onerror –∏ —Ç.–¥., –æ–Ω–∏ –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `DOMParser` —Å –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º —Ä–µ–∂–∏–º–æ–º –∏–ª–∏ sanitizer.

---

#### –ü—Ä–æ–±–ª–µ–º–∞: innerHTML –¥–ª—è UI —ç–ª–µ–º–µ–Ω—Ç–æ–≤
**–§–∞–π–ª:** `/home/user/Opis/js/uso.app.js`
**–°—Ç—Ä–æ–∫–∏:** 76-95
```javascript
modeInfo.innerHTML = `
  <div style="background: #f3e5f5; padding: 12px; border-radius: 4px; ...">
    <strong>üì∑ –†–µ–∂–∏–º –ø—Ä–æ—Å—Ç—ã—Ö —Ñ–æ—Ç–æ ...</strong>
    ...
  </div>
`;
```
**–ê–Ω–∞–ª–∏–∑:** 
- –≠—Ç–æ—Ç HTML –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–≤ –∫–æ–¥–µ)
- –ù–µ —Å–æ–¥–µ—Ä–∂–∏—Ç user-controlled –¥–∞–Ω–Ω—ã–µ
- **–ë–ï–ó–û–ü–ê–°–ù–û**

---

#### –ü—Ä–æ–±–ª–µ–º–∞: jQuery html() –≤ preview
**–§–∞–π–ª:** `/home/user/Opis/js/uso.app.js`
**–°—Ç—Ä–æ–∫–∏:** 538-540
```javascript
const html = await buildAllVariantSectionsTextOnlyHTML();
$('#uso-preview').html(html);  // ‚ö†Ô∏è –ß—Ç–æ —ç—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç?
previewOverride = '';
```
**–ê–Ω–∞–ª–∏–∑:** 
- `buildAllVariantSectionsTextOnlyHTML()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π HTML –∏–∑ `buildVariantSectionTZ()`
- `buildVariantSectionTZ()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `escapeHTML()` –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –•–æ—Ä–æ—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏, –Ω–æ —Å—Ç–æ–∏—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –ø—É—Ç–∏

---

### 2. XSS –£–Ø–ó–í–ò–ú–û–°–¢–ò

#### –ü—Ä–æ–±–ª–µ–º–∞: –ß–∞—Å—Ç–∏—á–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç XSS
**–§–∞–π–ª:** `/home/user/Opis/js/uso.export.js`
**–°—Ç—Ä–æ–∫–∏:** 284-288
```javascript
const esc = function(s){
  const div = document.createElement('div');
  div.textContent = String(s || '');
  return div.innerHTML;
};
```
**–•–æ—Ä–æ—à–æ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç textContent –≤–º–µ—Å—Ç–æ innerHTML –¥–ª—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
**–ù–æ:** –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ –≤ `buildPDFHtml`, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ –≤–µ–∑–¥–µ.

#### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è escapeHTML –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
**–§–∞–π–ª:** `/home/user/Opis/js/uso.app.js`
**–°—Ç—Ä–æ–∫–∏:** 26-30
```javascript
function escapeHTML(s){
  const div = document.createElement('div');
  div.textContent = String(s || '');
  return div.innerHTML;
}
```
**–•–æ—Ä–æ—à–æ:** –§—É–Ω–∫—Ü–∏—è –µ—Å—Ç—å.
**–ù–æ:** –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∑–¥–µ.

**–ü—Ä–∏–º–µ—Ä—ã –ø–ª–æ—Ö–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
**–§–∞–π–ª:** `/home/user/Opis/js/uso.app.js`
**–°—Ç—Ä–æ–∫–∏:** 1143-1150
```javascript
parts.push(
  '<p>–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, <b>'+escapeHTML(name||'')+'</b>.</p>'+
  // ... –º–Ω–æ–≥–æ –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–æ–∫ —Å escapeHTML
  '<p>–ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–∞—Ü–∏–µ–Ω—Ç–∞: '+escapeHTML(phoneMasked)+'</p>'
);
```
**–•–æ—Ä–æ—à–æ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è escapeHTML.

**–ù–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–µ—Å—Ç–∞:**
**–°—Ç—Ä–æ–∫–∏:** 1668-1673
```javascript
html = variants.map((v, i) => {
  const lc = v._lastCalc || {};
  return '<div ...>' +
         '<b>'+escapeHTML(v.title)+'</b><br>' +
         '–¢–µ—Ä–∞–ø–∏—è: '+U.util.money(lc.therapy||0)+' ‚ÇΩ<br>' +
         // ...
```
**–ê–Ω–∞–ª–∏–∑:** –•–æ—Ä–æ—à–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è escapeHTML –¥–ª—è title.

---

### 3. –ü–†–û–ë–õ–ï–ú–´ –° –û–ë–†–ê–ë–û–¢–ö–û–ô –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–û–ì–û –í–í–û–î–ê

#### –ü—Ä–æ–±–ª–µ–º–∞: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
**–§–∞–π–ª:** `/home/user/Opis/js/uso.app.js`
**–°—Ç—Ä–æ–∫–∏:** 126-130
```javascript
if (file.size > 40 * 1024 * 1024) {
  alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (>40 –ú–ë)');
  e.target.value = '';
  return;
}
```
**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (–ª–µ–≥–∫–æ –æ–±–æ–π—Ç–∏)
- –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–∞ (—Ç–æ–ª—å–∫–æ —Ç–∏–ø–∞ MIME, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–¥–¥–µ–ª–∞–Ω)
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é.

---

#### –ü—Ä–æ–±–ª–µ–º–∞: HEIC –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–Ω–µ—à–Ω–∏–π –∫–æ–¥
**–§–∞–π–ª:** `/home/user/Opis/js/uso.app.js`
**–°—Ç—Ä–æ–∫–∏:** 135-149
```javascript
if (isHeic) {
  try {
    const h2a = await ensureHeic2Any();
    if (h2a) {
      processedFile = await h2a({ blob:file, toType:'image/jpeg', quality:0.98 });
    }
  } catch(err) {
    console.warn('[USO] HEIC convert failed:', err);
    alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å HEIC');
  }
}
```
**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤–Ω–µ—à–Ω—é—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É –∏–∑ CDN (—É—è–∑–≤–∏–º–æ –¥–ª—è man-in-the-middle)
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç - –≤–∞–ª–∏–¥–Ω–æ–µ JPEG

**–†–µ—à–µ–Ω–∏–µ:** 
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ)
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

---

### 4. –ù–ï–ë–ï–ó–û–ü–ê–°–ù–ê–Ø –†–ê–ë–û–¢–ê –° –§–ê–ô–õ–ê–ú–ò

#### –ü—Ä–æ–±–ª–µ–º–∞: URL.createObjectURL –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞
**–§–∞–π–ª:** `/home/user/Opis/js/uso.app.js`
**–°—Ç—Ä–æ–∫–∏:** 159-168
```javascript
const blobUrl = URL.createObjectURL(processedFile);
// ...
const imgEl = await loadImageElement(blobUrl);
// ...
URL.revokeObjectURL(blobUrl);  // –•–û–†–û–®–û, –æ—á–∏—â–∞–µ—Ç—Å—è
```
**–ê–Ω–∞–ª–∏–∑:** –•–æ—Ä–æ—à–æ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `revokeObjectURL`.

**–ù–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö:**
**–§–∞–π–ª:** `/home/user/Opis/js/uso.export.js`
**–°—Ç—Ä–æ–∫–∏:** 851-858
```javascript
const a = document.createElement('a');
a.href = url;
a.download = filenameBase + '.pdf';
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
URL.revokeObjectURL(url);  // –•–û–†–û–®–û
```
**–•–æ—Ä–æ—à–æ –∑–¥–µ—Å—å**, –Ω–æ –≤ —Å—Ç—Ä–æ–∫–∞—Ö 1586-1589:
```javascript
const url = URL.createObjectURL(blob);
const a = document.createElement('a'); 
a.href=url; 
a.download=name; 
document.body.appendChild(a); 
a.click(); 
document.body.removeChild(a);
URL.revokeObjectURL(url);  // –•–û–†–û–®–û, –Ω–æ 100–º—Å –ø–æ—Å–ª–µ click
```

---

#### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑–º–µ—Ä–∞ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
**–§–∞–π–ª:** `/home/user/Opis/js/uso.export.js`
**–°—Ç—Ä–æ–∫–∏:** 660-663
```javascript
const blob = pdf.output('blob');
const name = (filenameBase||'otchet')+'.pdf';
DEBUG.log('[USO_EXPORT] PDF created, pages:', pageIndex, 'size:', Math.round(blob.size/1024), 'KB');
return { blob, name, pageIndex };
```
**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ PDF
- –î–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Å–Ω–∏–º–∫–∞–º–∏ PDF –º–æ–∂–µ—Ç –±—ã—Ç—å 500+ –ú–ë
- –ë—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ—Ç –Ω–µ —Å—É–º–µ—Ç—å –µ–≥–æ —Å–∫–∞—á–∞—Ç—å

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∏ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –∞—Ä—Ö–∏–≤.

---

### 5. –û–¢–°–£–¢–°–¢–í–ò–ï –í–ê–õ–ò–î–ê–¶–ò–ò –î–ê–ù–ù–´–•

#### –ü—Ä–æ–±–ª–µ–º–∞: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
**–§–∞–π–ª:** `/home/user/Opis/js/uso.calc.js`
**–°—Ç—Ä–æ–∫–∏:** 29-51
```javascript
function compute(cnt, jawSplits, selections, selectedMats){
  // ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ï–°–¢–¨
  if (!cnt || typeof cnt !== 'object') {
    cnt = {};
  }
```
**–•–æ—Ä–æ—à–æ:** –í–∞–ª–∏–¥–∞—Ü–∏—è –µ—Å—Ç—å!

#### –ü—Ä–æ–±–ª–µ–º–∞: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª–∏–Ω—ã —Å—Ç—Ä–æ–∫
**–§–∞–π–ª:** `/home/user/Opis/js/uso.app.js`
**–°—Ç—Ä–æ–∫–∏:** 926-932
```javascript
function buildTextReport(htmlContent) {
  const name = ($('#uso-patient-name').val() || '').trim();
  const rawPhone = ($('#uso-patient-phone').val() || '').trim();
```
**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã –∏–º–µ–Ω–∏
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞, —á—Ç–æ –∑–∞–º–µ–¥–ª–∏—Ç —Å–∏—Å—Ç–µ–º—É

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å maxlength="50" –Ω–∞ input –∏ –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

---

### 6. –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

#### –ü—Ä–æ–±–ª–µ–º–∞: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ localStorage –±–µ–∑ –∑–∞—â–∏—Ç—ã
**–§–∞–π–ª:** `/home/user/Opis/js/uso.app.js`
**–°—Ç—Ä–æ–∫–∏:** 670-671
```javascript
localStorage.setItem(AUTOSAVE_KEY, json);  // –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω–æ
```
**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –î–∞–Ω–Ω—ã–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ –≤ localStorage
- –õ—é–±–æ–π —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Å–∞–π—Ç–µ –º–æ–∂–µ—Ç –∏—Ö –ø—Ä–æ—á–∏—Ç–∞—Ç—å
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç shared computer, –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–Ω—ã

**–†–µ—à–µ–Ω–∏–µ:** 
- –®–∏—Ñ—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ localStorage
- –ò–ª–∏ —Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –î–æ–±–∞–≤–∏—Ç—å warning –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

#### –ü—Ä–æ–±–ª–µ–º–∞: Fetch –±–µ–∑ CSRF –∑–∞—â–∏—Ç—ã
**–§–∞–π–ª:** `/home/user/Opis/js/uso.export.js`
**–°—Ç—Ä–æ–∫–∏:** 293-296
```javascript
if ((!tpl || tpl.length<=10) && url && typeof fetch === 'function') {
  const r = await fetch(url, { credentials:'same-origin' });
  if (r.ok) tpl = await r.text();
}
```
**–ü—Ä–æ–±–ª–µ–º–∞:** 
- Fetch —Å credentials –º–æ–∂–µ—Ç –±—ã—Ç—å —É—è–∑–≤–∏–º –¥–ª—è CSRF
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ CSRF —Ç–æ–∫–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å CSRF —Ç–æ–∫–µ–Ω –≤ header –¥–ª—è –≤—Å–µ—Ö fetch –∑–∞–ø—Ä–æ—Å–æ–≤.

---

## –†–ï–ô–¢–ò–ù–ì –ö–†–ò–¢–ò–ß–ù–û–°–¢–ò

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (High Priority):
1. ‚úÖ XSS —á–µ—Ä–µ–∑ innerHTML (uso.export.js:545)
2. ‚úÖ –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–±–æ—Ä –ø–∏–∫—Å–µ–ª–µ–π canvas (uso.export.js:125-134) - –±–ª–æ–∫–∏—Ä—É–µ—Ç UI
3. ‚úÖ localStorage –±–µ–∑ –∑–∞—â–∏—Ç—ã (uso.app.js:670) - —É—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–∞
4. ‚úÖ –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç–æ–º (uso.app.js:126-130)

### –°—Ä–µ–¥–Ω–∏–µ (Medium Priority):
1. ‚úÖ –ù–µ—Ç debounce –Ω–∞ mouse:move (uso.canvas.js:902-908)
2. ‚úÖ ResizeObserver –±–µ–∑ –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ (uso.canvas.js:694-719)
3. ‚úÖ Autosave –ø–∏—à–µ—Ç –≤—Å–µ–≥–¥–∞ (uso.app.js:665-670) - —É—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏
4. ‚úÖ HEIC –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∏–∑ CDN (uso.app.js:138-149)

### –ù–∏–∑–∫–∏–µ (Low Priority):
1. ‚úÖ –ü–µ—Ä–µ–±–æ—Ä window (uso.export.js:66-72)
2. ‚úÖ –ù–µ—Ç progress indicator (uso.app.js:109-225)
3. ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ input (uso.app.js:556-593)

